<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Sébastien Boisgérault, Mines ParisTech">
  <title>Controllers</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="reveal.js/css/reveal.css">
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="reveal.js/css/theme/white.css" id="theme">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Controllers</h1>
  <p class="author">Sébastien Boisgérault, Mines ParisTech</p>
</section>

<section><section id="preamble" class="title-slide slide level1"><h1>Preamble</h1></section><section class="slide level2">

<pre><code>from numpy import *
from numpy.linalg import *
from numpy.testing import *
from matplotlib.pyplot import *
from scipy.integrate import *</code></pre>
</section></section>
<section><section id="controllability" class="title-slide slide level1"><h1>Controllability</h1></section><section id="definition" class="slide level2">
<h2>Definition</h2>
<p>The system <span class="math inline">\(\dot{x} = f(x,u)\)</span> is <strong>controllable</strong> if</p>
<ul>
<li><p>for any <span class="math inline">\(t_0 \in \mathbb{R}\)</span>, <span class="math inline">\(x_0 \in \mathbb{R}^n\)</span> and <span class="math inline">\(x_f \in \mathbb{R}^n\)</span>,</p></li>
<li><p>there are <span class="math inline">\(t_f &gt; 0\)</span> and <span class="math inline">\(u: [t_0, t_f] \to \mathbb{R}^m\)</span> such that</p></li>
<li><p>the solution <span class="math inline">\(x(t)\)</span> such that <span class="math inline">\(x(t_0)=x_0\)</span> satisfies</p>
<p><span class="math display">\[
x(t_f) = x_f.
\]</span></p></li>
</ul>
</section><section class="slide level2">

<p><img data-src="images/static/controllability.svg" /></p>
</section><section id="controllability-car" class="slide level2">
<h2><i class="fa fa-eye"></i> Controllability / Car</h2>
<p>The position <span class="math inline">\(x\)</span> (in meters) of a car of mass <span class="math inline">\(m\)</span> (in kg) on a straight road is governed by</p>
<p><span class="math display">\[
m \ddot{x} = u
\]</span></p>
<p>where <span class="math inline">\(u\)</span> the force (in Newtons) generated by its motor.</p>
</section><section class="slide level2">

<p>The car is initially at the origin of a road and motionless. We would like to drive it to across the location <span class="math inline">\(x_f &gt; 0\)</span> at speed <span class="math inline">\(v_f\)</span> and at time <span class="math inline">\(t_f &gt; 0\)</span>.</p>
<p><strong>Numerical values:</strong></p>
<ul>
<li><p><span class="math inline">\(m=1500 \, \mbox{kg}\)</span>,</p></li>
<li><p><span class="math inline">\(t_f=10 \, \mbox{s}\)</span>, <span class="math inline">\(x_f=100 \, \mbox{m}\)</span> and <span class="math inline">\(v_f=100 \, \mbox{km/h}\)</span>.</p></li>
</ul>
</section><section id="strategy" class="slide level2">
<h2>Strategy</h2>
<h3 id="step-1-trajectory-planning">Step 1 – Trajectory Planning</h3>
<p>We search for a <strong>reference trajectory</strong> for the state</p>
<p><span class="math display">\[X_r(t) = (x_r(t), \dot{x}_r(t))\]</span></p>
<p>such that:</p>
<ul>
<li><p><span class="math inline">\(x_r(0)=0\)</span>, <span class="math inline">\(\dot{x}_r(0) = 0\)</span>,</p></li>
<li><p><span class="math inline">\(x_r(t_f) = x_f\)</span>, <span class="math inline">\(\dot{x}_r(t_f) = v_f\)</span>.</p></li>
</ul>
</section><section class="slide level2">

<h3 id="step-2-admissibility">Step 2 – Admissibility</h3>
<p>We check that this reference trajectory is <strong>admissible</strong>, i.e. that we can find a control <span class="math inline">\(u_r(t)\)</span> such that the solution of the IVP is <span class="math inline">\(X(t) = X_r(t)\)</span> when <span class="math inline">\(X(0) = X_r(t)\)</span>.</p>
</section><section id="admissible-trajectory" class="slide level2">
<h2>Admissible Trajectory</h2>
<p>Here, if <span class="math inline">\(x_r\)</span> is smooth and if we apply the control <span class="math inline">\(u(t) = m\ddot{x}_r(t)\)</span>,</p>
<p><span class="math display">\[
  m \frac{d^2}{dt^2} (x-x_r) = 0, 
  \]</span> <span class="math display">\[
  (x-x_r)(0) = 0, \; \frac{d}{dt} (x-x_r)(0)= 0.
  \]</span></p>
<p>Thus, <span class="math inline">\(x(t) = x_r(t)\)</span> – and thus <span class="math inline">\(\dot{x}(t) = \dot{x}_r(t)\)</span> – for every <span class="math inline">\(t\geq 0\)</span>.</p>
</section><section id="reference-trajectory" class="slide level2">
<h2>Reference Trajectory</h2>
<p>We can find <span class="math inline">\(x_r\)</span> as a third-order polynomial in <span class="math inline">\(t\)</span></p>
<p><span class="math display">\[
x_r(t) = a t^3 + b t^2 + c t + d
\]</span></p>
<p>with</p>
<p><span class="math display">\[
a = \frac{v_f}{t_f^2}- 2\frac{x_f}{t_f^3}, \;
b = 3\frac{x_f}{t_f^2} - \frac{v_f}{tf},\;
c=0, \; d=0.
\]</span></p>
<p>(equivalently, with <span class="math inline">\(u(t)\)</span> as an affine function of <span class="math inline">\(t\)</span>).</p>
</section><section class="slide level2">

<pre><code>m = 1500.0
xf = 100.0
vf = 100.0 * 1000 / 3600 # m/s
tf = 10.0
a = vf/tf**2 - 2*xf/tf**3
b = 3*xf/tf**2 - vf/tf</code></pre>
</section><section class="slide level2">

<pre><code>def x(t):
    return a * t**3 + b * t**2
def d2_x(t):
    return 6 * a * t + 2 * b
def u(t):
    return m * d2_x(t)</code></pre>
</section><section class="slide level2">

<pre><code>y0 = [0.0, 0.0]
def fun(t, y):
    x, d_x = y
    d2_x = u(t) / m
    return [d_x, d2_x]
result = solve_ivp(fun, [0.0, tf], y0, dense_output=True)</code></pre>
</section><section class="slide level2">

<pre><code>figure()
t = linspace(0, tf, 1000)
xt = result[&quot;sol&quot;](t)[0]
plot(t, xt)
grid(True); xlabel(&quot;$t$&quot;); title(&quot;$x(t)$&quot;)</code></pre>
</section><section class="slide level2">

<p><img data-src="images/car.svg" /></p>
</section><section class="slide level2">

<pre><code>figure()
vt = result[&quot;sol&quot;](t)[1]
plot(t, 3.6 * vt)
grid(True); xlabel(&quot;$t$&quot;)
title(r&quot;$\dot{x}(t) \, \mbox{[km/h]}$&quot;)</code></pre>
</section><section class="slide level2">

<p><img data-src="images/car-speed.svg" /></p>
</section><section id="non-admissible-trajectory" class="slide level2">
<h2><i class="fa fa-question-circle-o"></i> Non-admissible trajectory</h2>
<p>Let <span class="math display">\[
\dot{x} = A x 
\; \mbox{ with } \; x\in \mathbb{R}^2, \; 
A = \left[
\begin{array}{cc}
0 &amp; 1 \\
0 &amp; 0
\end{array}
\right].
\]</span></p>
<p>Find a smooth reference trajectory <span class="math display">\[x_r(t), \,t\in[0, 1]\]</span> which is not admissible.</p>
</section><section id="pendulum" class="slide level2">
<h2><i class="fa fa-question-circle-o"></i> Pendulum</h2>
<p>Consider the pendulum with dynamics:</p>
<p><span class="math display">\[
  m \ell^2 \ddot{\theta} + b \dot{\theta} + mg \ell \sin \theta = u
  \]</span></p>
<ul>
<li><p>[<i class="fa fa-lightbulb-o"></i>, <i class="fa fa-superscript"></i>] Find a smooth reference trajectory that leads the pendulum from <span class="math inline">\(\theta(0)=0\)</span> and <span class="math inline">\(\dot{\theta}(0) = 0\)</span> to <span class="math inline">\(\theta(t_f) = \pi\)</span> and <span class="math inline">\(\dot{\theta}(t_f) = 0\)</span>.</p></li>
<li><p>[<i class="fa fa-lightbulb-o"></i>, <i class="fa fa-superscript"></i>] Show that the reference trajectory is admissible and compute the corresponding input <span class="math inline">\(u(t)\)</span> as a function of <span class="math inline">\(t\)</span> and <span class="math inline">\(\theta(t)\)</span>.</p></li>
</ul>
</section><section class="slide level2">

<ul>
<li><p>[<i class="fa fa-flask"></i>, <i class="fa fa-laptop"></i>] Simulate the result with standard and high-precision (small steps). What should happen theoretically after <span class="math inline">\(t=t_f\)</span> if <span class="math inline">\(u(t)=0\)</span> is applied ? What does happen in practice ?</p>
<p>Numerical Values:</p>
<p><span class="math display">\[
m = 1.0, \, l = 1.0, \, b = 0.1,\, g = 9.81, \, t_f = 10.
\]</span></p></li>
</ul>
<!--
--------------------------------------------------------------------------------

    tf = 10.0
    def theta(t):
        return -2*pi*(t/tf)**3 + 3*pi*(t/tf)**2
    figure()
    t = linspace(0.0, tf, 1000)
    grid(True); xlabel("$t$"); title(r"$\theta(t)$")
    plot(t, theta(t))


::: hidden :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

    tight_layout()
    save("images/pendulum-theta")

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


::: slides :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

--------------------------------------------------------------------------------

![](images/pendulum-theta.svg)

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

--------------------------------------------------------------------------------

    def d_theta(t):
        return -6*pi*t**2/tf**3 + 6*pi*t/tf**2
    def d2_theta(t):
        return -12*pi*t/tf**3 + 6*pi/tf**2


--------------------------------------------------------------------------------

    figure()
    t = linspace(0.0, tf, 1000)
    grid(True); xlabel("$t$"); title(r"$\dot{\theta}(t)$")
    plot(t, d_theta(t))


::: hidden :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

    tight_layout()
    save("images/pendulum-d_theta")

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

::: slides :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

--------------------------------------------------------------------------------

![](images/pendulum-d_theta.svg)

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

--------------------------------------------------------------------------------

    figure()
    t = linspace(0.0, tf, 1000)
    grid(True); xlabel("$t$"); title(r"$\ddot{\theta}(t)$")
    plot(t, d2_theta(t))

::: hidden :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

    tight_layout()
    save("images/pendulum-d2_theta")

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

::: slides :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

--------------------------------------------------------------------------------

![](images/pendulum-d2_theta.svg)

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

--------------------------------------------------------------------------------

    m = 1.0; l = 1.0; b = 0.1; g = 9.81
    def u(t):
        return (m * l**2 * d2_theta(t) + \
               b * d_theta(t) + \
               m * g * l * sin(theta(t))) * (t <= tf)

--------------------------------------------------------------------------------

    figure()
    t = linspace(0.0, 2 * tf, 1000)
    grid(True); xlabel("$t$"); title("$u(t)$")
    plot(t, u(t))


::: hidden :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

    tight_layout()
    save("images/pendulum-u")

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

::: slides :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

--------------------------------------------------------------------------------

![](images/pendulum-u.svg)

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

--------------------------------------------------------------------------------

    def fun(t, y):
        theta, d_theta = y
        J = m * l**2
        d2_theta = - g / l * sin(theta) \
                   - b / J * d_theta \
                   + u(t) / J
        return [d_theta, d2_theta]

--------------------------------------------------------------------------------

    y0 = [0.0, 0.0]
    t_span = [0.0, 2*tf]
    result = solve_ivp(fun, t_span, y0, dense_output=True, max_step=0.1)

--------------------------------------------------------------------------------

    figure()
    t = linspace(0.0, tf, 1000)
    plot(t, theta(t), "k--")
    t = linspace(0.0, 2*tf, 1000)
    plot(t, result["sol"](t)[0], "k")
    #plot(result["t"], result["y"][0], "k+")
    grid(True); xlabel("$t$"); title(r"$\theta(t)$")

::: hidden :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

    tight_layout()
    save("images/pendulum-sol")

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

::: slides :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

--------------------------------------------------------------------------------

![](images/pendulum-sol.svg)

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

-->
</section><section id="controllability-lti-system" class="slide level2">
<h2>Controllability / LTI system</h2>
<p>For a LTI system, it is sufficient to check that</p>
<ul>
<li><p>from the origin <span class="math inline">\(x_0 = 0\)</span> at <span class="math inline">\(t_0=0\)</span>,</p></li>
<li><p>we can reach any state <span class="math inline">\(x_f \in \mathbb{R}^n\)</span>.</p></li>
</ul>
</section><section id="kalman-criterion" class="slide level2">
<h2>Kalman Criterion</h2>
<p>The system <span class="math inline">\(\dot{x} = Ax+Bu\)</span> is controllable iff:</p>
<p><span class="math display">\[
  \mathrm{rank} \, \left[B, AB, \dots, A^{n-1} B\right] = n
  \]</span></p>
<p><span class="math inline">\([B, \dots, A^{n-1}B]\)</span> is the <strong>Kalman controllability matrix</strong>.</p>
</section><section id="kalman-controllability-matrix" class="slide level2">
<h2><i class="fa fa-eye"></i> Kalman controllability matrix</h2>
<p><span class="math display">\[
A = 
\left[ 
\begin{array}{ccc}
0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1 \\
0 &amp; 0 &amp; 0
\end{array}
\right], \;
B = 
\left[ 
\begin{array}{c}
0 \\
0 \\
1 
\end{array}
\right]
\]</span></p>
</section><section id="computation" class="slide level2">
<h2>Computation</h2>
<pre><code>def KCM(A, B):
    n = shape(A)[0]
    mp = matrix_power
    cs = column_stack
    return cs([mp(A, k) @ B for k in range(n)])</code></pre>
</section><section class="slide level2">

<pre><code>n = 3 
A = zeros((n, n))
for i in range(0, n-1):
    A[i,i+1] = 1.0

B = zeros((n, 1))
B[n-1, 0] = 1.0</code></pre>
</section><section class="slide level2">

<pre><code>C = KCM(A, B)

C_expected = [[0, 0, 1], [0, 1, 0], [1, 0, 0]]
assert_almost_equal(C, C_expected)</code></pre>
</section><section id="fully-actuated-system" class="slide level2">
<h2><i class="fa fa-question-circle-o"></i> Fully Actuated System</h2>
<p>Consider <span class="math inline">\(\dot{x} = A x + Bu\)</span> with <span class="math inline">\(x \in \mathbb{R}^n\)</span>, <span class="math inline">\(u \in\mathbb{R}^n\)</span> and <span class="math inline">\(\mathrm{rank} \, B = n\)</span>.</p>
<ul>
<li><p>[<i class="fa fa-lightbulb-o"></i>, <i class="fa fa-superscript"></i>] Is the systems controllable ?</p></li>
<li><p>[<i class="fa fa-lightbulb-o"></i>, <i class="fa fa-superscript"></i>] Given <span class="math inline">\(x_0\)</span>, <span class="math inline">\(x_f\)</span> and <span class="math inline">\(t_f &gt; 0\)</span>, show that any smooth trajectory that leads from <span class="math inline">\(x_0\)</span> to <span class="math inline">\(x_f\)</span> in <span class="math inline">\(t_f\)</span> seconds is admissible.</p></li>
</ul>
</section><section id="integrator-chain" class="slide level2">
<h2><i class="fa fa-question-circle-o"></i> Integrator Chain</h2>
<p><img data-src="images/static/integrator-chain.svg" /> <span class="math display">\[\dot{x}_n = u, \, \dot{x}_{n-1} = x_n, \, \cdots \,, \dot{x}_1 = x_2.\]</span></p>
</section><section class="slide level2">

<ul>
<li>[<i class="fa fa-lightbulb-o"></i>, <i class="fa fa-superscript"></i>] Show that the system is controllable</li>
</ul>
</section><section id="heat-equation" class="slide level2">
<h2><i class="fa fa-question-circle-o"></i> Heat Equation</h2>
<p><img data-src="images/static/heat-simple.svg" /></p>
</section><section class="slide level2">

<ul>
<li><p><span class="math inline">\(d T_1/dt = u + (T_2 - T_1)\)</span></p></li>
<li><p><span class="math inline">\(d T_2/dt = (T_1 - T_2) + (T_3 - T_2)\)</span></p></li>
<li><p><span class="math inline">\(d T_3/dt = (T_2 - T_3) + (T_4 - T_3)\)</span></p></li>
<li><p><span class="math inline">\(d T_4/dt = (T_3 - T_4)\)</span></p></li>
</ul>
</section><section class="slide level2">

<ul>
<li><p>[<i class="fa fa-lightbulb-o"></i>, <i class="fa fa-superscript"></i>] Show that the system is controllable.</p></li>
<li><p>[<i class="fa fa-lightbulb-o"></i>, <i class="fa fa-superscript"></i>] Is it still true if the four cells are organized as a square and the heat sink/source is in any of the corners ? How many independent sources do you need to make the system controllable and where can you place them?</p></li>
</ul>
</section><section id="extra-exercices" class="slide level2">
<h2>Extra Exercices</h2>
<ul>
<li><p>Unreachable states</p></li>
<li><p>Brunovsky form</p></li>
<li><p>Controllability in prey-predator systems (via the invariant)</p></li>
<li><p>etc.</p></li>
</ul>
</section></section>
<section><section id="asymptotic-stabilization" class="title-slide slide level1"><h1>Asymptotic Stabilization</h1></section><section id="stabilization" class="slide level2">
<h2>Stabilization</h2>
<p>When the system</p>
<p><span class="math display">\[
\dot{x} = A x, \; x \in \mathbb{R}^n
\]</span></p>
<p>is not asymptotically stable at the origin,</p>
<p>maybe there are some inputs <span class="math inline">\(u \in \mathbb{R}^m\)</span> such that</p>
<p><span class="math display">\[
\dot{x} = A x + Bu
\]</span></p>
<p>that we can use to stabilize asymptotically the system?</p>
</section><section id="linear-feedback" class="slide level2">
<h2>Linear Feedback</h2>
<p>We can try to compute <span class="math inline">\(u\)</span> as</p>
<p><span class="math display">\[
u(t) = -K x(t)
\]</span></p>
<p>fro some <span class="math inline">\(K \in \mathbb{R}^{m \times n}\)</span></p>
<p><i class="fa fa-sticky-note"></i> <strong>Note.</strong> This strategy requires the system state <span class="math inline">\(x(t)\)</span> to be known (measured); this information is then <strong>fed back</strong> into the system.</p>
</section><section id="closed-loop-diagram" class="slide level2">
<h2>Closed-Loop Diagram</h2>
<p><img data-src="images/static/feedback.svg" /></p>
</section><section id="closed-loop-dynamics" class="slide level2">
<h2>Closed-Loop Dynamics</h2>
<p>When</p>
<p><span class="math display">\[
  \begin{array}{ccc}
  \dot{x} = Ax + B u \\
  u = - K x
  \end{array}
  \]</span></p>
<p>the state <span class="math inline">\(x \in \mathbb{R}^n\)</span> evolves according to:</p>
<p><span class="math display">\[
  \dot{x} = (A - B K) x
  \]</span></p>
</section><section class="slide level2">

<p>The closed-loop system is asymptotically stable iff every eigenvalue of the matrix</p>
<p><span class="math display">\[
A - B K
\]</span></p>
<p>is in the open left-hand plane.</p>
</section><section id="pole-assignment" class="slide level2">
<h2>Pole Assignment</h2>
<p>Assume that:</p>
<ul>
<li><p>The systems <span class="math inline">\(\dot{x} = A x + Bu\)</span> is controllable.</p></li>
<li><p>Let <span class="math inline">\(\Lambda = \{\lambda_1, \dots, \lambda_n\} \in \mathbb{C}^n\)</span> be a (multi-)set of complex numbers (a value may appear several times) which is symmetric:</p>
<p>if <span class="math inline">\(\lambda \in \Lambda\)</span>, then <span class="math inline">\(\overline{\lambda} \in \Lambda\)</span> (with the same multiplicity)</p></li>
</ul>
</section><section class="slide level2">

<ul>
<li><p>Let <span class="math inline">\(\sigma(A - BK)\)</span> denote the (multi-)set of eigenvalues of <span class="math inline">\(A - B K\)</span> (eigenvalues are counted with their multiplicity).</p></li>
<li><p>Then there is a matrix <span class="math inline">\(K\)</span> such that</p>
<p><span class="math display">\[
\sigma(A - B K) = \Lambda.
\]</span></p></li>
</ul>
</section><section id="stabilizationpole-assignment" class="slide level2">
<h2><i class="fa fa-eye"></i> Stabilization/Pole Assignment</h2>
<p>Consider the double integrator <span class="math inline">\(\ddot{x} = u\)</span></p>
<p><span class="math display">\[
  \frac{d}{dt}
  \left[\begin{array}{c} x \\ \dot{x} \end{array}\right]
  =
  \left[\begin{array}{cx} 0 &amp; 1 \\ 0 &amp; 0\end{array}\right]
  \left[\begin{array}{c} x \\ \dot{x} \end{array}\right]
  +
  \left[\begin{array}{c} 0 \\ 1 \end{array}\right]
  u
  \]</span></p>
<p>(in standard form)</p>
</section><section class="slide level2">

<pre><code>from scipy.signal import place_poles
A = array([[0, 1], [0, 0]])
B = array([[0], [1]])
poles = [-1, -2]
K = place_poles(A, B, poles).gain_matrix</code></pre>
</section><section class="slide level2">

<pre><code>assert_almost_equal(K, [[2.0, 3.0]])
eigenvalues, _ = eig(A - B @ K)
assert_almost_equal(eigenvalues, [-1, -2])</code></pre>
</section><section id="section" class="slide level2">
<h2><i class="fa fa-area-chart"></i></h2>
<pre><code>figure()
x = [real(s) for s in eigenvalues]
y = [imag(s) for s in eigenvalues]
plot(x, y, &quot;kx&quot;, ms=12.0)
xticks([-3, -2,-1, 0,1, 2,3])
yticks([-3, -2,-1, 0,1, 2,3])
plot([0, 0], [-3, 3], &quot;k&quot;)
plot([-3, 3], [0, 0], &quot;k&quot;)   
title(&quot;Eigenvalues&quot;)
grid(True)</code></pre>
</section><section class="slide level2">

<p><img data-src="images/poles-PA.svg" /></p>
</section><section id="implementation-detail" class="slide level2">
<h2><i class="fa fa-warning"></i> Implementation detail</h2>
<ul>
<li><p>The <code>place_poles</code> function will not accept eigenvalues whose multiplicity is higher than the rank of <span class="math inline">\(B\)</span>.</p></li>
<li><p>So here <code>poles = [-1, -1]</code> won’t work.</p></li>
<li><p>But <code>poles = [-1, -1.001]</code> may work.</p></li>
</ul>
</section><section id="pole-assignment-default" class="slide level2">
<h2><i class="fa fa-question-circle-o"></i> Pole Assignment / Default</h2>
<p>Consider system with dynamics</p>
<p><span class="math display">\[
\begin{array}{ccr}
\dot{x}_1 &amp;=&amp; x_1 - x_2 + u \\
\dot{x}_2 &amp;=&amp; - x_1 + x_2 + u
\end{array}
\]</span></p>
<ul>
<li><p>[<i class="fa fa-lightbulb-o"></i>,<i class="fa fa-superscript"></i>]. We apply the control law <span class="math display">\[u = -k_1 x_1 - k_2 x_2;\]</span> can we move the poles of the system where we want by a suitable choice of <span class="math inline">\(k_1\)</span> and <span class="math inline">\(k_2\)</span>?</p></li>
<li><p>[<i class="fa fa-lightbulb-o"></i>] Explain this result.</p></li>
</ul>
</section><section id="pendulum-1" class="slide level2">
<h2><i class="fa fa-question-circle-o"></i> Pendulum</h2>
<p>Consider the pendulum with dynamics:</p>
<p><span class="math display">\[
m \ell^2 \ddot{\theta} + b \dot{\theta} + mg \ell \sin \theta = u
\]</span></p>
<ul>
<li>[<i class="fa fa-lightbulb-o"></i>, <i class="fa fa-superscript"></i>] Compute the linearized dynamics of the system around the equilibrium <span class="math inline">\(\theta=\pi\)</span> and <span class="math inline">\(\dot{\theta} = 0\)</span>.</li>
</ul>
</section><section class="slide level2">

<ul>
<li><p>[<i class="fa fa-lightbulb-o"></i>, <i class="fa fa-superscript"></i>] Design a control law <span class="math display">\[
u = -k_{1} (\theta - \pi) - k_{2} \dot{\theta}
\]</span> such that the closed-loop linear system is asymptotically stable, with a time constant smaller than <span class="math inline">\(10\)</span> sec.</p>
<p>Numerical Values:</p>
<p><span class="math display">\[
m = 1.0, \, l = 1.0, \, b = 0.1,\, g = 9.81
\]</span></p></li>
</ul>
</section><section class="slide level2">

<ul>
<li>[<i class="fa fa-flask"></i>, <i class="fa fa-laptop"></i>] Simulate this control law on the nonlinear systems when <span class="math inline">\(\theta(0) = 0\)</span> and <span class="math inline">\(\dot{\theta}(0) = 0\)</span>; compare with the open-loop strategy that we have already considered.</li>
</ul>
</section><section id="double-spring-system" class="slide level2">
<h2><i class="fa fa-question-circle-o"></i> Double Spring System</h2>
<p>Consider the dynamics:</p>
<p><span class="math display">\[
\begin{array}{rcl}
m_1 \ddot{x}_1 &amp; = &amp; -k_1 x_1 - k_2 (x_1 - x_2) - b_1 \dot{x}_1 \\
m_2 \ddot{x}_2 &amp; = &amp; -k_2 (x_2 - x_1) - b_2 \dot{x}_2 + u
\end{array}
\]</span></p>
</section><section class="slide level2">

<p>Numerical values: <span class="math display">\[
m_1 = m_2 = 1, \; k_1 = 1, k_2 = 100, \; b_1 = 0, \; b_2 = 20
\]</span></p>
<ul>
<li><p>[<i class="fa fa-flask"></i>, <i class="fa fa-laptop"></i>] Compute the poles of the system. Is it asymptotically stable?</p></li>
<li><p>[<i class="fa fa-flask"></i>, <i class="fa fa-laptop"></i>] Use a linear feedback to kill the oscillatory behavior of the solutions and “speed up” the eigenvalues associated to a slow behavior.</p></li>
</ul>
</section></section>
<section><section id="optimal-control" class="title-slide slide level1"><h1>Optimal Control</h1></section><section id="why" class="slide level2">
<h2>Why ?</h2>
<p><strong>Limitations of Pole Assignment</strong></p>
<ul>
<li><p>it is not always obvious what set of poles we should target (especially for large systems),</p></li>
<li><p>we do not control explicitly the trade-off between “speed of convergence” and “intensity of the control” (large input values maybe costly or impossible).</p></li>
</ul>
</section><section class="slide level2">

<p>Let</p>
<p><span class="math display">\[\dot{x} = A x + Bu\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(A \in \mathbb{R}^{n\times n}\)</span>, <span class="math inline">\(B \in \mathbb{R}^{m\times n}\)</span> and</p></li>
<li><p><span class="math inline">\(x(0) = x_0 \in \mathbb{R}^n\)</span> is given.</p></li>
</ul>
</section><section class="slide level2">

<p>Find <span class="math inline">\(u(t)\)</span> that minimizes</p>
<p><span class="math display">\[ 
  J = \int_0^{+\infty} x(t)^t Q x(t) + u(t)^t R u(t) \, dt
  \]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(Q \in \mathbb{R}^{n \times n}\)</span> and <span class="math inline">\(R \in \mathbb{R}^{m\times m}\)</span>,</p></li>
<li><p>(to be continued …)</p></li>
</ul>
</section><section class="slide level2">

<ul>
<li><p><span class="math inline">\(Q\)</span> and <span class="math inline">\(R\)</span> are <strong>symmetric</strong> (<span class="math inline">\(R^t = R\)</span> and <span class="math inline">\(Q^t = Q\)</span>),</p></li>
<li><p><span class="math inline">\(Q\)</span> and <span class="math inline">\(R\)</span> are <strong>positive definite</strong> (denoted “<span class="math inline">\(&gt;0\)</span>”)</p>
<p><span class="math display">\[x^t Q x \geq 0 \, \mbox{ and } \, x^t Q x = 0 \, \mbox{ iff }\, x=0\]</span></p>
<p>and</p>
<p><span class="math display">\[u^t R u \geq 0 \, \mbox{ and } \, u^t R u = 0 \, \mbox{ iff }\, u=0.\]</span></p></li>
</ul>
</section><section id="heuristics-scalar-case" class="slide level2">
<h2>Heuristics / Scalar Case</h2>
<p>If <span class="math inline">\(x \in \mathbb{R}\)</span> and <span class="math inline">\(u \in \mathbb{R}\)</span>,</p>
<p><span class="math display">\[ 
  J = \int_0^{+\infty} q x(t)^2 + r u(t)^2 \, dt
  \]</span></p>
<p>with <span class="math inline">\(q &gt; 0\)</span> and <span class="math inline">\(r &gt; 0\)</span>.</p>
</section><section class="slide level2">

<p>When we minimize <span class="math inline">\(J\)</span>:</p>
<ul>
<li><p>Only the relative values of <span class="math inline">\(q\)</span> and <span class="math inline">\(r\)</span> matters.</p></li>
<li><p>Large values of <span class="math inline">\(q\)</span> penalize strongly non-zero states:</p>
<p><span class="math inline">\(\Rightarrow\)</span> fast convergence.</p></li>
<li><p>Large values of <span class="math inline">\(r\)</span> penalize strongly non-zero inputs:</p>
<p><span class="math inline">\(\Rightarrow\)</span> small input values.</p></li>
</ul>
</section><section id="heuristics-vector-case" class="slide level2">
<h2>Heuristics / Vector Case</h2>
<p>If <span class="math inline">\(x \in \mathbb{R}^n\)</span> and <span class="math inline">\(u \in \mathbb{R}^m\)</span> and <span class="math inline">\(Q\)</span> and <span class="math inline">\(R\)</span> are diagonal,</p>
<p><span class="math display">\[
Q = \mathrm{diag}(q_1, \cdots, q_n), \; R=\mathrm{diag}(r_1, \cdots, r_m),
\]</span></p>
<p><span class="math display">\[ 
  J = \int_0^{+\infty} \sum_{i} q_i x_i(t)^2 + \sum_j r_j u_j(t)^2 \, dt
  \]</span></p>
<p>with <span class="math inline">\(q_i &gt; 0\)</span> and <span class="math inline">\(r_j &gt; 0\)</span>.</p>
<p>Thus we can control the cost of each component of <span class="math inline">\(x\)</span> and <span class="math inline">\(u\)</span> independently.</p>
</section><section id="optimal-solution" class="slide level2">
<h2>Optimal Solution</h2>
<p>Assume that <span class="math inline">\(\dot{x} = A x + Bu\)</span> is controllable.</p>
<p>There is an optimal solution; it is a linear feedback</p>
<p><span class="math display">\[u = - K x\]</span></p>
<p>The corresponding closed-loop dynamics is asymptotically stable.</p>
</section><section id="algebraic-riccati-equation" class="slide level2">
<h2>Algebraic Riccati Equation</h2>
<p>The gain matrix <span class="math inline">\(K\)</span> is given by</p>
<p><span class="math display">\[
  K = R^{-1} B^t \Pi,
  \]</span></p>
<p>where <span class="math inline">\(\Pi \in \mathbb{R}^{n \times n}\)</span> is the unique matrix such that <span class="math inline">\(\Pi^t = \Pi\)</span>, <span class="math inline">\(\Pi &gt; 0\)</span> and</p>
<p><span class="math display">\[
   \Pi B R^{-1} B^t \Pi - \Pi A - A^t \Pi - Q = 0.
   \]</span></p>
</section><section id="value-of-j" class="slide level2">
<h2><i class="fa fa-question-circle-o"></i> Value of <span class="math inline">\(J\)</span></h2>
<p>Consider the dynamics <span class="math inline">\(\dot{x} = A x + Bu\)</span> where <span class="math inline">\(u=-Kx\)</span> is the optimal control associated to</p>
<p><span class="math display">\[
J = \int_{0}^{+\infty} j(x(t), u(t)) \, dt
\]</span></p>
<p>where</p>
<p><span class="math display">\[
j(x, u) = x^t Q x + u^t R u.
\]</span></p>
</section><section class="slide level2">

<ul>
<li><p>[<i class="fa fa-lightbulb-o"></i>, <i class="fa fa-superscript"></i>] Show that <span class="math display">\[
j(x(t), u(t)) = - \frac{d}{dt} x(t)^t \Pi x(t)
\]</span></p></li>
<li><p>[<i class="fa fa-lightbulb-o"></i>, <i class="fa fa-superscript"></i>] What is the value of <span class="math inline">\(J\)</span> in the optimal case?</p></li>
</ul>
</section><section id="stabilizationoptimal-control" class="slide level2">
<h2><i class="fa fa-eye"></i> Stabilization/Optimal Control</h2>
<p>Consider the double integrator <span class="math inline">\(\ddot{x} = u\)</span></p>
<p><span class="math display">\[
  \frac{d}{dt}
  \left[\begin{array}{c} x \\ \dot{x} \end{array}\right]
  =
  \left[\begin{array}{cx} 0 &amp; 1 \\ 0 &amp; 0\end{array}\right]
  \left[\begin{array}{c} x \\ \dot{x} \end{array}\right]
  +
  \left[\begin{array}{c} 0 \\ 1 \end{array}\right]
  u
  \]</span></p>
<p>(in standard form)</p>
</section><section class="slide level2">

<pre><code>from scipy.linalg import solve_continuous_are
A = array([[0, 1], [0, 0]])
B = array([[0], [1]])
Q = array([[1, 0], [0, 1]]); R = array([[1]])
Pi = solve_continuous_are(A, B, Q, R)
K = inv(R) @ B.T @ Pi
eigenvalues, _ = eig(A - B @ K)
assert all([real(s) &lt; 0 for s in eigenvalues])</code></pre>
</section><section id="section-1" class="slide level2">
<h2><i class="fa fa-area-chart"></i></h2>
<pre><code>figure()
x = [real(s) for s in eigenvalues]
y = [imag(s) for s in eigenvalues]
plot(x, y, &quot;kx&quot;, ms=12.0)
xticks([-2, -1, 0, 1, 2])
yticks([-2, -1, 0, 1, 2])
plot([0, 0], [-2, 2], &quot;k&quot;)
plot([-2, 2], [0, 0], &quot;k&quot;)   
grid(True)
title(&quot;Eigenvalues&quot;)</code></pre>
</section><section class="slide level2">

<p><img data-src="images/poles-LQ.svg" /></p>
</section><section class="slide level2">

<pre><code>y0 = [1.0, 1.0]
def f(t, x):
    return (A - B.dot(K)).dot(x)
result = solve_ivp(f, t_span=[0, 10], y0=y0, max_step=0.1)
t = result[&quot;t&quot;]
x1 = result[&quot;y&quot;][0]
x2 = result[&quot;y&quot;][1]
u = -K.dot(result[&quot;y&quot;]).flatten()</code></pre>
</section><section class="slide level2">

<pre><code>figure()
plot(t, x1, &quot;k-&quot;, label=&quot;$x_1$&quot;)
plot(t, x2, &quot;k--&quot;, label=&quot;$x_2$&quot;)
plot(t, u, &quot;k:&quot;, label=&quot;$u$&quot;)
xlabel(&quot;$t$&quot;)
legend()</code></pre>
</section><section class="slide level2">

<p><img data-src="images/poles-LQ-traj.svg" /></p>
</section><section class="slide level2">

<pre><code>Q = array([[10, 0], [0, 10]]); R = array([[1]])
Pi = solve_continuous_are(A, B, Q, R)
K = inv(R) @ B.T @ Pi</code></pre>
</section><section class="slide level2">

<pre><code>result = solve_ivp(f, t_span=[0, 10], y0=y0, max_step=0.1)
t = result[&quot;t&quot;]
x1 = result[&quot;y&quot;][0]
x2 = result[&quot;y&quot;][1]
u = -K.dot(result[&quot;y&quot;]).flatten()</code></pre>
</section><section class="slide level2">

<pre><code>figure()
plot(t, x1, &quot;k-&quot;, label=&quot;$x_1$&quot;)
plot(t, x2, &quot;k--&quot;, label=&quot;$x_2$&quot;)
plot(t, u, &quot;k:&quot;, label=&quot;$u$&quot;)
xlabel(&quot;$t$&quot;)
legend()</code></pre>
</section><section class="slide level2">

<p><img data-src="images/poles-LQ-2-traj.svg" /></p>
</section><section class="slide level2">

<pre><code>Q = array([[1, 0], [0, 1]]); R = array([[10]])
Pi = solve_continuous_are(A, B, Q, R)
K = inv(R) @ B.T @ Pi</code></pre>
</section><section class="slide level2">

<pre><code>result = solve_ivp(f, t_span=[0, 10], y0=y0, max_step=0.1)
t = result[&quot;t&quot;]
x1 = result[&quot;y&quot;][0]
x2 = result[&quot;y&quot;][1]
u = -K.dot(result[&quot;y&quot;]).flatten()</code></pre>
</section><section class="slide level2">

<pre><code>figure()
plot(t, x1, &quot;k-&quot;, label=&quot;$x_1$&quot;)
plot(t, x2, &quot;k--&quot;, label=&quot;$x_2$&quot;)
plot(t, u, &quot;k:&quot;, label=&quot;$u$&quot;)
xlabel(&quot;$t$&quot;)
legend()</code></pre>
</section><section class="slide level2">

<p><img data-src="images/poles-LQ-3-traj.svg" /></p>
<!--
<i class="fa fa-question-circle-o"></i> Optimal Control / Asymmetry
--------------------------------------------------------------------------------

 - [<i class='fa fa-gears'></i>] What can be done if $Q$ and/or $R$ is not symmetric?

-->
</section><section id="extra-exercise" class="slide level2">
<h2>Extra Exercise</h2>
<ul>
<li>“Lunar lander” for “rendez-vous” with limited fuel?</li>
</ul>
<style>

.reveal section img {
  border:0;
  height:50vh;
  width:auto;

}

.reveal section img.medium {
  border:0;
  max-width:50vh;
}

.reveal section img.icon {
  display:inline;
  border:0;
  width:1em;
  margin:0em;
  box-shadow:none;
  vertical-align:-10%;
}

.reveal code {
  font-family: Inconsolata, monospace;
}

.reveal pre code {
  font-size: 1.5em;
  line-height: 1.5em;
  /* max-height: 80wh; won't work, overriden */
}

input {
  font-family: "Source Sans Pro", Helvetica, sans-serif;
  font-size: 42px;
  line-height: 54.6px;
}

</style>
<p><link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet"></p>
<p><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet"></p>
</section></section>
    </div>
  </div>

  <script src="reveal.js/lib/js/head.min.js"></script>
  <script src="reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display the page number of the current slide
        slideNumber: true,
        // Push each slide change to the browser history
        history: true,
        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/math/math.js', async: true },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
